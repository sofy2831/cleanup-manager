<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CleanUp Manager – Boutique</title>

  <style>
    :root{
      --violet-light:#F3ECFF;
      --violet-mid:#DCCBFF;
      --violet-main:#7A5CFF;
      --violet-dark:#6238FF;
      --text-dark:#111;
      --green:#1b8f4d;
      --grey:#777;
      --bad:#b3261e;
    }

    body{
      margin:0;
      padding:0;
      font-family:"Comic Sans MS", sans-serif;
      background:linear-gradient(180deg,#F8F4FF 0%,#EDE6FF 80%);
      color:var(--text-dark);
    }

    .page{
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:16px 16px 32px;
      box-sizing:border-box;
    }

    /* TOPBAR */
    .topbar{
      width:100%;
      max-width:980px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      position:sticky;
      top:0;
      z-index:10;
      padding:10px 0;
      background:rgba(248,244,255,.85);
      backdrop-filter:blur(6px);
    }

    .pill-link{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background:#fff;
      border:2px solid var(--violet-main);
      color:var(--violet-main);
      text-decoration:none;
      font-weight:900;
      font-size:13px;
      box-shadow:0 3px 10px rgba(0,0,0,.06);
      white-space:nowrap;
      cursor:pointer;
    }

    .pill-link.primary{
      background:linear-gradient(90deg,var(--violet-main),var(--violet-dark));
      border-color:transparent;
      color:#fff;
      box-shadow:0 4px 12px rgba(0,0,0,.15);
    }

    /* LOGO + TITRE */
    .logo-title{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:8px;
      margin-top:8px;
      margin-bottom:6px;
      text-align:center;
    }

    .logo-icon{
      width:38px;height:38px;border-radius:50%;
      background:#fff;
      border:2px solid var(--violet-main);
      display:flex;align-items:center;justify-content:center;
      color:var(--violet-main);
      font-size:20px;
      font-weight:900;
      position:relative;
      flex-shrink:0;
    }
    .logo-icon::after{
      content:"✦";
      position:absolute;
      top:-6px; right:-4px;
      font-size:12px;
      color:var(--violet-main);
    }

    h1{ font-size:24px; margin:0; font-weight:900; color:#111; }
    .subtitle{ font-size:16px; color:#444; margin-top:4px; text-align:center; }
    .badge{
      margin-top:10px;
      padding:4px 10px;
      border-radius:999px;
      background:#fff;
      font-size:12px;
      color:#555;
      box-shadow:0 3px 10px rgba(0,0,0,.06);
      text-align:center;
    }

    /* EXPLAIN */
    .explain{
      width:100%;
      max-width:980px;
      margin-top:12px;
      background:#fff;
      border-radius:18px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      padding:14px 14px 16px;
      box-sizing:border-box;
      text-align:left;
      border-left:5px solid var(--violet-main);
    }
    .explain h2{ font-size:15px; margin:0 0 6px; }
    .explain p{ margin:6px 0 0; font-size:13px; line-height:1.35; color:#444; }
    .notice{
      margin-top:10px;
      font-size:12px;
      color:#555;
      background:var(--violet-light);
      padding:8px 10px;
      border-radius:12px;
      font-weight:900;
    }

    /* NAV */
    .top-nav{
      width:100%;
      max-width:980px;
      margin-top:12px;
      background:#fff;
      padding:4px;
      border-radius:999px;
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:4px;
      box-shadow:0 4px 12px rgba(0,0,0,.08);
    }
    .top-nav a{
      text-decoration:none;
      font-size:12px;
      padding:6px 12px;
      border-radius:999px;
      color:#555;
    }
    .top-nav a.active{
      background:var(--violet-main);
      color:#fff;
      font-weight:900;
    }

    /* LAYOUT */
    .kits-layout{
      width:100%;
      max-width:980px;
      margin-top:14px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    @media (min-width:768px){
      .kits-layout{ flex-direction:row; align-items:flex-start; }
    }

    .left-column{ flex:1.4; display:flex; flex-direction:column; gap:12px; }
    .right-column{ flex:1; }

    .card{
      background:linear-gradient(180deg,#FFFFFF 0%,#EEE4FF 100%);
      border-radius:18px;
      box-shadow:0 6px 18px rgba(0,0,0,.10);
      padding:16px 14px 18px;
      box-sizing:border-box;
    }

    .card-title{
      font-size:16px;
      font-weight:900;
      margin-bottom:8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    .card-title span.sub{
      font-size:12px;
      font-weight:400;
      color:#666;
    }

    /* LISTE */
    .kits-list{
      display:flex;
      flex-direction:column;
      gap:10px;
      max-height:460px;
      overflow-y:auto;
    }

    .kit-item{
      background:#fff;
      border-radius:16px;
      padding:10px;
      box-shadow:0 3px 10px rgba(0,0,0,.05);
      font-size:12px;
      text-align:left;
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .kit-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }

    .kit-main{ display:flex; flex-direction:column; gap:2px; }
    .kit-name{ font-size:14px; font-weight:900; color:#333; }

    .kit-tags{
      display:flex;
      flex-wrap:wrap;
      gap:4px;
      margin-top:2px;
    }

    .kit-tag{
      padding:2px 8px;
      border-radius:999px;
      font-size:10px;
      background:var(--violet-light);
      color:#5b45c8;
      font-weight:900;
    }
    .kit-tag.type{ background:#e3f6eb; color:var(--green); }

    .kit-toggle{
      font-size:11px;
      padding:2px 10px;
      border-radius:999px;
      border:1px solid #D3C7FF;
      background:#f7f4ff;
      color:#555;
      cursor:pointer;
      white-space:nowrap;
      font-weight:900;
    }
    .kit-toggle.active{
      background:var(--violet-main);
      color:#fff;
      border-color:var(--violet-main);
    }

    .kit-content-title{
      font-size:11px;
      font-weight:900;
      color:#555;
      margin-top:4px;
    }
    .kit-content-list{
      margin:0;
      padding-left:16px;
      font-size:11px;
      color:#555;
    }
    .kit-content-list li{ margin-bottom:2px; }

    .kit-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:11px;
      color:#777;
      flex-wrap:wrap;
      gap:4px;
    }

    /* FORM */
    .form-card-title{ font-size:15px; font-weight:900; margin-bottom:6px; }
    .form-subtitle{ font-size:12px; color:#555; margin-bottom:12px; }
    form{ display:flex; flex-direction:column; gap:8px; }

    .form-group{ text-align:left; }
    .form-group label{
      display:block;
      font-size:12px;
      font-weight:900;
      margin-bottom:4px;
      color:#333;
    }

    .form-group input,
    .form-group select,
    .form-group textarea{
      width:100%;
      box-sizing:border-box;
      padding:7px 9px;
      border-radius:10px;
      border:1px solid #D3C7FF;
      font-size:12px;
      outline:none;
      background:#fff;
      font-family:"Comic Sans MS", sans-serif;
    }

    .inline-fields{ display:flex; gap:8px; }
    .inline-fields .form-group{ flex:1; }

    .small-hint{
      font-size:10px;
      color:var(--grey);
      margin-top:2px;
      line-height:1.25;
    }

    .checkbox-row{
      display:flex;
      align-items:flex-start;
      gap:6px;
      margin-top:4px;
    }
    .checkbox-row input[type="checkbox"]{ margin-top:2px; }
    .checkbox-row label{
      font-size:11px;
      font-weight:400;
      color:#444;
      line-height:1.25;
    }

    .cta-btn{
      margin-top:10px;
      width:100%;
      border:none;
      border-radius:999px;
      padding:9px 14px;
      font-size:13px;
      font-weight:900;
      color:#fff;
      background:linear-gradient(90deg,var(--violet-main),var(--violet-dark));
      cursor:pointer;
      box-shadow:0 4px 12px rgba(0,0,0,.18);
    }

    .fineprint{
      font-size:11px;
      color:#666;
      text-align:center;
      margin-top:10px;
      line-height:1.25;
    }
  </style>
</head>

<body>
<script>
  function getSession(){
    try{ return JSON.parse(localStorage.getItem("cm_auth") || "null"); }
    catch(e){ return null; }
  }
  function requireRole(role){
    const s = getSession();
    if(!s || s.role !== role){
      location.href = "login.html?role=" + encodeURIComponent(role);
    }
  }
  function logout(){
    localStorage.removeItem("cm_auth");
    location.href = "index.html";
  }
  requireRole("conciergerie");
</script>

<div class="page">

  <!-- TOPBAR -->
  <div class="topbar">
    <a class="pill-link" href="conciergerie.html">← Tableau de bord</a>
    <div style="display:flex; gap:8px; align-items:center;">
      <button class="pill-link" type="button" onclick="logout()">Déconnexion</button>
    </div>
  </div>

  <!-- LOGO + TITRE -->
  <div class="logo-title">
    <div class="logo-icon">✓</div>
    <h1>CleanUp Manager</h1>
  </div>

  <div class="subtitle">Boutique – Kits (conciergerie)</div>
  <div class="badge">V1 : kits persistants (localStorage). Prix = plus tard.</div>

  <div class="top-nav">
    <a href="planning.html">Planning</a>
    <a href="logements.html">Logements</a>
    <a href="prestations.html">Prestations</a>
    <a href="messagerie.html">Messagerie</a>
    <a href="paiements.html">Paiements</a>
    <a href="historique.html">Historique</a>
    <a class="active" href="boutique.html">Boutique</a>
  </div>

  <div class="explain">
    <h2>Pourquoi une boutique ?</h2>
    <p>
      Tu centralises des <b>kits prêts à poser</b> (ménage, cuisine, salle de bain, accueil…)
      que tu rattaches ensuite à tes prestations. Résultat : <b>standardisation</b>, <b>gain de temps</b>, moins d’oublis.
    </p>
    <div class="notice">V1 : prix masqués. V2 : marges, stock, alertes, fournisseur.</div>
  </div>

  <div class="kits-layout">

    <!-- GAUCHE -->
    <div class="left-column">
      <div class="card">
        <div class="card-title">
          <span>Mes kits</span>
          <span class="sub" id="kitsCountLabel"></span>
        </div>

        <div class="kits-list" id="kitsList"></div>
      </div>

      <div class="fineprint">
        Astuce : “Actif par défaut” = proposé automatiquement (plus tard : association à types de prestations).
      </div>
    </div>

    <!-- DROITE -->
    <div class="right-column">
      <div class="card">
        <div class="form-card-title">Créer un kit</div>
        <div class="form-subtitle">
          V1 : création + activation. V2 : stock + seuil + prix + fournisseur.
        </div>

        <form id="kitForm">
          <div class="form-group">
            <label for="kit-name">Nom du kit</label>
            <input id="kit-name" type="text" placeholder="Ex. Kit ménage standard" required>
          </div>

          <div class="inline-fields">
            <div class="form-group">
              <label for="kit-type">Catégorie</label>
              <select id="kit-type">
                <option value="Ménage">Ménage</option>
                <option value="Cuisine">Cuisine</option>
                <option value="Salle de bain">Salle de bain</option>
                <option value="Bienvenue">Bienvenue / accueil</option>
                <option value="Autre">Autre</option>
              </select>
            </div>

            <div class="form-group">
              <label>Tarif</label>
              <input type="text" value="V2 (abonnement)" disabled>
              <div class="small-hint">On l’ajoute quand tu passes en mode abonnement.</div>
            </div>
          </div>

          <div class="form-group">
            <label for="kit-content">Contenu</label>
            <textarea id="kit-content" rows="4"
              placeholder="- 1 éponge emballée
- 1 spray multi-surfaces 500 ml
- 3 pastilles lave-vaisselle
- 2 sacs poubelle 30L"></textarea>
            <div class="small-hint">Un élément par ligne. C’est la checklist terrain.</div>
          </div>

          <div class="checkbox-row">
            <input id="kit-active-default" type="checkbox" checked>
            <label for="kit-active-default">Actif par défaut.</label>
          </div>

          <button class="cta-btn" type="submit">Ajouter ce kit</button>
        </form>
      </div>
    </div>

  </div>
</div>

<script>
  const DATA_KEY = "cm_conciergerie_data_v1";

  function uid(prefix){
    return (prefix||"x") + "_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16);
  }
  function loadData(){
    try{
      const raw = localStorage.getItem(DATA_KEY);
      if(raw) return JSON.parse(raw);
    }catch(e){}
    return null;
  }
  function saveData(d){ localStorage.setItem(DATA_KEY, JSON.stringify(d)); }
  
  function ensureData(){
    const existing = loadData();
    if(existing) return existing;

    const seeded = { homes:[], events:[], services:[], threads:[], payments:[], icalSources:[], kits:[],requests:[]  };
    saveData(seeded);
    return seeded;
  }

  const app = ensureData();
  app.kits = Array.isArray(app.kits) ? app.kits : [];
  app.requests = Array.isArray(app.requests) ? app.requests : [];

  function seedKitsIfEmpty(){
    if(app.kits.length) return;

    app.kits = [
      {
        id: uid("k"),
        name: "Kit essentiel",
        type: "Essentiel",
        price: 9.90,
        active: true,
        content: [
          "1 éponge emballée",
          "1 microfibre multi-usages",
          "1 spray multi-surfaces",
          "1 capsule sol fraicheur",
          "1 flacon liquide vaisselle",
          "2 pastilles lave-vaisselle",
          "2 sacs poubelle 30L",
          "1 capsule gel WC"
        ],
        note: "Parfait pour les séjours courts T2/T3."
      },
      {
        id: uid("k"),
        name: "Kit cuisine",
        type: "Cuisine",
        price: 5.90,
        active: true,
        content: [
          "2 dosettes thé",
          "2 dosettes café",
          "Dosettes sucre",
          "Huile + vinaigre",
          "Sel + poivre",
          "1 rouleau essuie-tout"
        ],
        note: "Idéal pour les arrivées type Airbnb."
      },
      {
        id: uid("k"),
        name: "Kit hygiène 2 personnes",
        type: "Salle de bain",
        price: 7.90,
        active: false,
        content: [
          "2 rouleaux papier toilette",
          "2 savon mains",
          "2 gel douche",
          "2 shampoing",
          "1 démêlant",
          "2 mini-serviettes emballées"
        ],
        note: "À activer sur les séjours de +2 nuits."
      },
      {
        id: uid("k"),
        name: "Kit hygiène 4 personnes",
        type: "Salle de bain",
        price: 15.80,
        active: true,
        content: [
          "3 rouleaux papier toilette",
          "4 savon mains",
          "4 gel douche",
          "4 shampoing",
          "2 démêlant",
          "4 mini-serviettes emballées"
        ],
        note: "À activer sur les séjours de +2 nuits."
      }
    ];

    saveData(app);
  }

  seedKitsIfEmpty();

  const SHOW_PRICES = false;

  const kitsListEl = document.getElementById("kitsList");
  const kitsCountLabel = document.getElementById("kitsCountLabel");
  const kitForm = document.getElementById("kitForm");

  function escapeHtml(str){
    return String(str ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function renderKits(){
    kitsListEl.innerHTML = "";
    kitsCountLabel.textContent = app.kits.length + " kit" + (app.kits.length>1 ? "s" : "");

    app.kits.forEach((kit) => {
      const item = document.createElement("div");
      item.className = "kit-item";

      const header = document.createElement("div");
      header.className = "kit-header";

      const main = document.createElement("div");
      main.className = "kit-main";

      const nameEl = document.createElement("div");
      nameEl.className = "kit-name";
      nameEl.textContent = kit.name;

      const tagsEl = document.createElement("div");
      tagsEl.className = "kit-tags";

      const typeTag = document.createElement("span");
      typeTag.className = "kit-tag type";
      typeTag.textContent = kit.type;
      tagsEl.appendChild(typeTag);

      if(SHOW_PRICES && kit.price != null){
        const priceTag = document.createElement("span");
        priceTag.className = "kit-tag";
        priceTag.textContent = Number(kit.price).toFixed(2).replace(".", ",") + " €";
        tagsEl.appendChild(priceTag);
      }

      main.appendChild(nameEl);
      main.appendChild(tagsEl);

      const toggleBtn = document.createElement("button");
      toggleBtn.type = "button";
      toggleBtn.className = "kit-toggle" + (kit.active ? " active" : "");
      toggleBtn.textContent = kit.active ? "Actif par défaut" : "Inactif";
      toggleBtn.addEventListener("click", () => {
        kit.active = !kit.active;
        saveData(app);
        renderKits();
      });

      header.appendChild(main);
      header.appendChild(toggleBtn);
      item.appendChild(header);

      if(Array.isArray(kit.content) && kit.content.length){
        const contentTitle = document.createElement("div");
        contentTitle.className = "kit-content-title";
        contentTitle.textContent = "Contenu :";
        item.appendChild(contentTitle);

        const ul = document.createElement("ul");
        ul.className = "kit-content-list";
        kit.content.forEach(line => {
          const li = document.createElement("li");
          li.textContent = line;
          ul.appendChild(li);
        });
        item.appendChild(ul);
      }

      const footer = document.createElement("div");
      footer.className = "kit-footer";

      const noteEl = document.createElement("div");
      noteEl.textContent = kit.note || "";

      const statusEl = document.createElement("div");
      statusEl.textContent = kit.active
        ? "Proposé par défaut."
        : "À activer manuellement.";

      footer.appendChild(noteEl);
      footer.appendChild(statusEl);
      item.appendChild(footer);

      kitsListEl.appendChild(item);
    });
  }

  kitForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const name = document.getElementById("kit-name").value.trim();
    const type = document.getElementById("kit-type").value;
    const contentText = document.getElementById("kit-content").value.trim();
    const activeDefault = document.getElementById("kit-active-default").checked;

    if(!name) return;

    const contentLines = contentText
      ? contentText.split("\n").map(l => l.replace(/^[-•]\s*/, "").trim()).filter(Boolean)
      : [];

    app.kits.unshift({
      id: uid("k"),
      name,
      type,
      price: null,
      active: activeDefault,
      content: contentLines,
      note: "Kit personnalisé."
    });

    saveData(app);
    renderKits();

    document.getElementById("kit-name").value = "";
    document.getElementById("kit-content").value = "";
    document.getElementById("kit-type").value = "Ménage";
    document.getElementById("kit-active-default").checked = true;
  });

  renderKits();
</script>
</body>
</html>
