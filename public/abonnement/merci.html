<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CleanUp Manager – Paiement confirmé</title>

  <style>
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:linear-gradient(180deg,#F8F4FF 0%,#EDE6FF 80%);
      color:#111;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      text-align:center;
      padding:16px;
      box-sizing:border-box;
    }
    .card{
      background:#fff;
      border-radius:20px;
      box-shadow:0 10px 30px rgba(0,0,0,.15);
      padding:24px 20px 26px;
      max-width:520px;
      width:100%;
    }
    .icon{ font-size:42px; margin-bottom:6px; }
    h1{ margin:6px 0; font-size:24px; font-weight:900; }
    .subtitle{ font-size:15px; color:#444; margin-bottom:16px; }
    .plan{ font-weight:900; font-size:16px; margin-bottom:12px; color:#5b45c8; }
    .msg{ font-size:13px; color:#555; line-height:1.4; }
    .countdown{ margin-top:16px; font-size:12px; color:#666; }
    .btn{
      display:inline-block;
      margin-top:18px;
      padding:10px 16px;
      border-radius:999px;
      text-decoration:none;
      font-weight:900;
      color:#fff;
      background:linear-gradient(90deg,#7A5CFF,#6238FF);
      box-shadow:0 4px 12px rgba(0,0,0,.18);
    }
  </style>
</head>

<body>

<div class="card">
  <div class="icon">✅</div>
  <h1>Paiement confirmé</h1>
  <div class="subtitle">Merci pour ta confiance</div>

  <div class="plan" id="planLine">—</div>

  <div class="msg">
    Ton abonnement est maintenant actif.<br>
    Redirection vers ton espace conciergerie…
  </div>

  <div class="countdown" id="countdown">Redirection dans 5 secondes…</div>

  <a class="btn" href="conciergerie.html">
    Accéder à mon tableau de bord
  </a>
</div>

<script>
/* ===== Utils ===== */
function getParam(name){
  return new URLSearchParams(location.search).get(name);
}
function getSession(){
  try{ return JSON.parse(localStorage.getItem("cm_auth") || "null"); }
  catch(e){ return null; }
}
function setSession(obj){
  localStorage.setItem("cm_auth", JSON.stringify(obj));
}

/* ===== Plans ===== */
const PLANS = {
  starter: "Starter",
  pro: "Pro",
  business: "Business",
  illimite: "Illimité"
};

const planKey = String(getParam("plan") || "").toLowerCase();

/* ===== Guard ===== */
if(!PLANS[planKey]){
  document.getElementById("planLine").textContent = "Plan introuvable";
  document.querySelector(".msg").innerHTML =
    "Le plan n’a pas été reconnu.<br>Retourne sur la page abonnements.";
  document.getElementById("countdown").style.display = "none";
} else {
  /* ===== Activation (V1 localStorage) ===== */
  const current = getSession() || {};

  const nextSession = {
    ...current,
    role: "conciergerie",
    plan: planKey,
    planName: PLANS[planKey],
    planActive: true,
    planActivatedAt: Date.now()
  };

  setSession(nextSession);

  /* ===== UI ===== */
  document.getElementById("planLine").textContent =
    "Abonnement activé : " + PLANS[planKey];

  /* ===== Redirect ===== */
  let t = 5;
  const cd = document.getElementById("countdown");

  const timer = setInterval(()=>{
    t--;
    cd.textContent = "Redirection dans " + t + " secondes…";
    if(t <= 0){
      clearInterval(timer);
      location.href = "conciergerie.html";
    }
  }, 1000);
}
</script>

</body>
</html>
