<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CleanUp Manager – Tableau de bord</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    *, *::before, *::after { box-sizing:border-box; }
    :root{
      --violet-light:#F3ECFF;
      --violet-main:#7A5CFF;
      --violet-dark:#6238FF;
      --text:#111;
      --muted:#666;
      --border: rgba(122,92,255,0.18);
      --bad:#b3261e;
      --ok:#1b8f4d;
    }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg,#F8F4FF 0%,#EDE6FF 80%);
      color:var(--text);
    }
    .page{
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:16px 16px 32px;
    }
    .topbar{
      width:100%;
      max-width:980px;
      position:sticky;
      top:0;
      z-index:10;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:10px 0;
      background:rgba(248,244,255,.85);
      backdrop-filter:blur(6px);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background:#fff;
      border:2px solid var(--violet-main);
      color:var(--violet-main);
      text-decoration:none;
      font-weight:900;
      font-size:13px;
      white-space:nowrap;
      cursor:pointer;
      box-shadow:0 3px 10px rgba(0,0,0,.06);
    }
    .pill.primary{
      background:linear-gradient(90deg,var(--violet-main),var(--violet-dark));
      border-color:transparent;
      color:#fff;
      box-shadow:0 4px 12px rgba(0,0,0,.15);
    }

    .logo-title{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:10px;
      margin-top:10px;
      margin-bottom:6px;
      text-align:center;
    }
    .logo-icon{
      width:44px;height:44px;border-radius:50%;
      background:#fff;
      border:2px solid var(--violet-main);
      display:flex;align-items:center;justify-content:center;
      color:var(--violet-main);
      font-size:22px;font-weight:900;
      position:relative;
      flex-shrink:0;
    }
    .logo-icon::after{
      content:"✦";
      position:absolute;
      top:-6px; right:-5px;
      font-size:12px;
      color:var(--violet-main);
    }
    h1{ margin:0; font-size:26px; font-weight:900; letter-spacing:-0.2px; }
    .subtitle{ margin-top:2px; font-size:14px; color:#444; text-align:center; }
    .emailLine{ margin-top:4px; font-size:13px; color:var(--muted); font-weight:700; text-align:center; }

    
       .grid{
      width:100%;
      max-width:980px;
      margin-top:16px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media(min-width:820px){
      .grid{ grid-template-columns: repeat(3, 1fr); }
    }

    .card{
      background: rgba(255,255,255,0.86);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: 0 14px 36px rgba(0,0,0,0.08);
      backdrop-filter: blur(10px);
      padding: 16px 14px 14px;
      text-align:left;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .card h2{
      margin:0;
      font-size:16px;
      font-weight:900;
    }
    .card p{
      margin:0;
      font-size:12px;
      color:#666;
      line-height:1.35;
    }
    .cta{
      display:inline-flex;
      justify-content:center;
      align-items:center;
      gap:8px;
      padding:12px 14px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      text-decoration:none;
      font-weight:900;
      font-size:13px;
      background:linear-gradient(90deg,var(--violet-main),var(--violet-dark));
      color:#fff;
      box-shadow:0 12px 24px rgba(0,0,0,0.10);
    }

    .alert{
      width:100%;
      max-width:980px;
      display:none;
      margin-top:12px;
      padding:10px 12px;
      background:#fff;
      border-radius:14px;
      border-left:5px solid var(--bad);
      box-shadow:0 3px 10px rgba(0,0,0,.06);
      font-size:12px;
      color:#444;
      white-space:pre-wrap;
    }
    .alert.ok{ border-left-color: var(--ok); }

/* === Bottom nav (mobile) === */
.bottom-nav{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 50;
  display: flex;
  gap: 6px;
  justify-content: space-around;
  align-items: center;

  padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
  background: rgba(255,255,255,0.92);
  border-top: 1px solid rgba(122,92,255,0.18);
  backdrop-filter: blur(10px);
}

.bottom-nav a{
  flex: 1;
  text-align: center;
  text-decoration: none;
  font-size: 11px;
  font-weight: 900;
  color: #666;
  padding: 10px 8px;
  border-radius: 999px;
  white-space: nowrap;
}

.bottom-nav a.active{
  background: linear-gradient(90deg,var(--violet-main),var(--violet-dark));
  color:#fff;
  box-shadow: 0 10px 22px rgba(0,0,0,0.10);
}

/* On ajoute de l'espace en bas pour ne pas cacher le contenu */
.page{ padding-bottom: 90px; }

/* Sur desktop: on remet la nav "en haut" OU on la cache */
@media(min-width: 860px){
  .bottom-nav{
    position: static;
    max-width: 980px;
    margin-top: 12px;
    border-top: none;
    border: 1px solid rgba(122,92,255,0.18);
    border-radius: 999px;
    box-shadow: 0 4px 12px rgba(0,0,0,.08);
  }
  .page{ padding-bottom: 32px; }
}

    
  </style>
</head>

<body>
  <div class="page">
    <div class="topbar">
      <a class="pill" href="index.html">← Accueil</a>
      <button class="pill" id="logoutBtn" type="button">Déconnexion</button>
    </div>

    <div class="logo-title">
      <div class="logo-icon">✓</div>
      <h1>CleanUp Manager</h1>
    </div>
    <div class="subtitle">Espace conciergerie</div>
    <div class="emailLine" id="emailLine">—</div>

    

    <div class="alert" id="alertBox"></div>

    <div class="grid">
      <div class="card">
        <h2>Planning (opérationnel)</h2>
        <p>Réservations iCal + prestations (jobs). Clique une réservation → crée la prestation liée.</p>
        <a class="cta" href="planning.html">Ouvrir le planning</a>
      </div>

      <div class="card">
        <h2>Inviter un propriétaire</h2>
        <p>Génère un lien unique. Le propriétaire crée son accès gratuitement.</p>
        <a class="cta" href="invite.html">Inviter un propriétaire</a>
      </div>

      <div class="card">
        <h2>Ajouter un logement</h2>
        <p>Crée un logement, rattache un propriétaire, prépare la gestion.</p>
        <a class="cta" href="logements.html">Ajouter un logement</a>
      </div>
<nav class="bottom-nav" aria-label="Navigation">
  <a href="conciergerie.html" class="active">Accueil</a>
  <a href="planning.html">Planning</a>
  <a href="logements.html">Logements</a>
  <a href="prestations.html">Catalogue</a>
  <a href="import-ical.html">iCal</a>
</nav>

      
    </div>
  </div>

  <script type="module">
    import { auth, db } from "./firebase-init.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const emailLine = document.getElementById("emailLine");
    const alertBox = document.getElementById("alertBox");
    const logoutBtn = document.getElementById("logoutBtn");

    function showAlert(msg, ok=false){
      alertBox.style.display = "block";
      alertBox.classList.toggle("ok", !!ok);
      alertBox.textContent = msg;
    }
    function hideAlert(){
      alertBox.style.display = "none";
      alertBox.classList.remove("ok");
      alertBox.textContent = "";
    }

    // emails admin gratuits
    const FREE_EMAILS = new Set([
      "mathilde.debout31@gmail.com",
      "s.dumas974@gmail.com"
    ]);

    async function guardConciergerie(user){
      const email = (user.email || "").toLowerCase();
      if(FREE_EMAILS.has(email)) return true;

      try{
        const snap = await getDoc(doc(db, "users", user.uid));
        if(!snap.exists()) return false;
        const data = snap.data() || {};
        return (data.role === "conciergerie" || data.role === "admin") && (data.subscriptionStatus === "active");
      }catch(e){
        return false;
      }
    }

    logoutBtn.addEventListener("click", async ()=>{
      await signOut(auth);
      localStorage.removeItem("cm_auth");
      location.href = "index.html";
    });

    onAuthStateChanged(auth, async (user)=>{
      if(!user){
        location.href = "login.html?role=conciergerie";
        return;
      }

      emailLine.textContent = user.email || user.uid;

      const ok = await guardConciergerie(user);
      if(!ok){
        showAlert("⛔ Abonnement inactif. Merci de choisir une offre.", false);
        setTimeout(()=> location.href = "abonnement.html?plan=starter", 700);
        return;
      }

      hideAlert();
    });
  </script>
</body>
</html>
